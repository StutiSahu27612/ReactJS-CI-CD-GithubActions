name:  CI

# on:
#   push:
#     branches:
#       - main
      
#   pull_request:
#     branches:
#       - main
on:
  workflow_dispatch:
     

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
    # Step 1: Checkout the code
    - name: Checkout code
      uses: actions/checkout@v3

    # Step 2: Set up Node.js environment
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 16 # Ensure this matches your Node.js version

        
    # - name: Run Trivy vulnerability scanner in repo mode
    #   uses: aquasecurity/trivy-action@0.20.0
    #   with:
    #     scan-type: 'fs'
    #     ignore-unfixed: true
    #     format: table
    
    #     severity: 'CRITICAL'



    # Step 4: Run tests
    - name: Run tests
      run: npm test

    - name : Run Coverage
      run: npm run coverage  
        

    - name : SonarQube scan   
      uses: sonarsource/sonarqube-scan-action@master
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

    - name: Build Docker image
      run: |
       docker build -t reactjs-app-image .





